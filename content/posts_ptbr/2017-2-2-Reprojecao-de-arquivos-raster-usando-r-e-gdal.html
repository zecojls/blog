---
title: R√°pida reproje√ß√£o de arquivos raster usando R e gdal
author: Jos√© Lucas Safanelli
date: '2018-03-01'
slug: rapida-reprojecao-raster-r
categories:
  - r
tags:
  - raster
  - reprojection
  - gdal
  - r
---



<div id="motivacao" class="section level3">
<h3>Motiva√ß√£o</h3>
<p>Esta postagem disponibiliza uma solu√ß√£o r√°pida e automatizada para reproje√ß√£o de arquivos raster usando o R. H√° um tempo atr√°s, quando pesquisei sobre este assunto, acabei encontrando algumas solu√ß√µes muito demoradas, o que me levou a pesquisar mais a fundo e desenvolver a solu√ß√£o aqui compartilhada.</p>
<p>A reproje√ß√£o √© necess√°ria, por exemplo, quando efetuamos o download de imagens de sat√©lite e precisamos coloc√°-las em um sistema de refer√™ncia de coordenadas (SRC) padr√£o de algum projeto, diferente do SRC original das imagens. A solu√ß√£o aqui apresentada √© baseada na execu√ß√£o do programa GDAL (<em>Geospatial Data Abstraction Library</em>) dentro do R, utilizando a fun√ß√£o <code>gdalwarp</code>.</p>
<p>A utiliza√ß√£o do pacote <code>raster</code> para reproje√ß√£o de imagens tamb√©m √© muito citada pela web. Utilizando o pacote raster, entretanto, a reproje√ß√£o de uma √∫nica banda da imagem de sat√©lite demora cerca de 2 minutos. Por outro lado, a abordagem via GDAL √© muito mais r√°pida, demorando cerca de 5 segundos. √â uma diferen√ßa absurda, principalmente se objetivo for executar esse procedimento em milhares de imagens. Para executar o GDAL no R, utiliza-se o pacote <code>gdalUtils</code>, aliado ao pressuposto de que o GDAL j√° esteja previamente instalado no computador.</p>
</div>
<div id="solucao" class="section level3">
<h3>Solu√ß√£o</h3>
<p>Carregue os pacotes necess√°rios listados abaixo. Caso n√£o os possua, utilize a fun√ß√£o <code>install.packages(&quot;pacote&quot;)</code> para instal√°-los diretamente do CRAN.</p>
<pre class="r"><code>library(raster)
library(sp)
library(gdalUtils)
library(rgdal)</code></pre>
<p>Em seguida, crie uma lista contendo os arquivos raster.</p>
<pre class="r"><code>setwd(&quot;D:/diretorio-imagens&quot;)
dados &lt;- list.files(getwd(), pattern = &quot;\\.tif&quot;)
dados</code></pre>
<p>Recupere informa√ß√µes do SRC alvo utilizando a fun√ß√£o <code>make_EPSG</code> do pacote rgdal.</p>
<pre class="r"><code>EPSG.list &lt;- make_EPSG()</code></pre>
<p>O SRC <strong>SIRGAS 2000 UTM zone 22S</strong> √© utilizado como exemplo para a reproje√ß√£o das imagens. Dentre as informa√ß√µes que a fun√ß√£o <code>make_EPSG</code> retorna, o c√≥digo <strong>prj4</strong> √© aquele que ir√° de fato ser utilizado para a reproje√ß√£o via GDAL.</p>
<pre class="r"><code>sirgas &lt;- EPSG.list[grep(&quot;SIRGAS 2000 / UTM zone 22S&quot;, EPSG.list$note),]</code></pre>
<p>Utilize o pacote <strong>raster</strong> para transformar algum arquivo do objeto <strong>dados</strong> em um objeto raster dentro do R. A fun√ß√£o <code>raster()</code> √© utilizada para tal prop√≥sito.</p>
<pre class="r"><code>raster.exemplo &lt;- raster(dados[1])</code></pre>
<p>Com o <code>raster.exemplo</code> √© poss√≠vel recuperar o SRC original das imagens. √â importante lembrar que todas estas imagens devem possuir este mesmo SRC. Caso contr√°rio, dever√° ser utiliza outra abordagem que liste cada SRC individualmente.</p>
<p>Os objetos <code>SRC.velho</code> e <code>SRC.novo</code> possuem, respectivamente, o SRC original e SRC alvo que ser√£o utilizados na reproje√ß√£o.</p>
<pre class="r"><code>SRC.velho &lt;- projection(raster.exemplo)
SRC.novo &lt;- as.character(sirgas$prj4); SRC.novo</code></pre>
<p>Para executar a reproje√ß√£o de todas as imagens listadas no objeto <code>dados</code>, utilize o loop apresentado abaixo. Os argumentos da fun√ß√£o <code>dgalwarp</code> s√£o:</p>
<ul>
<li><p><code>srcfile</code>: representa a i√©sima imagem a ser reprojetada que est√° listada no objeto dados;</p></li>
<li><p><code>dstfile</code>: nomea automaticamente o arquivo reprojetado com o c√≥digo EPSG novo na frente do nome;</p></li>
<li><p><code>s_srs</code>: c√≥digo PRJ4 do SRC original;</p></li>
<li><p><code>t_srs</code>: c√≥digo PRJ4 do SRC alvo;</p></li>
<li><p><code>r</code>: reamostragem via vizinho mais pr√≥ximo;</p></li>
<li><p><code>output_Raster</code>: gera o arquivo no diret√≥rio de trabalho;</p></li>
<li><p><code>overwrite</code>: sobrescreve caso j√° exista algum arquivo com mesmo nome;</p></li>
<li><p><code>verbose</code> -&gt; mostra a execu√ß√£o GDAL no console do R</p></li>
</ul>
<pre class="r"><code>for(i in 1:length(dados)) {
     gdalwarp(srcfile = dados[i],
              dstfile = paste(&quot;EPSG&quot;, sirgas$code, dados[i], sep = &quot;_&quot;),
              s_srs = SRC.velho,
              t_srs = SRC.novo,
              r = &quot;near&quot;,
              output_Raster = TRUE,
              overwrite = TRUE,
              verbose = TRUE)
}</code></pre>
<p>Qualquer d√∫vida, utilize os coment√°rios üëç</p>
</div>
